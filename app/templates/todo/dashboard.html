{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="mb-0">Dashboard</h4>
  <div class="d-flex gap-2">
    <a class="btn btn-sm btn-outline-primary" href="{{ url_for('todo.list_page') }}">목록 보기</a>
  </div>
</div>

<!-- Summary cards -->
<div class="row g-3 mb-4">
  <div class="col-6 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted small">전체</div>
        <div class="fs-3 fw-bold">{{ summary.total or 0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted small">미완료</div>
        <div class="fs-3 fw-bold">{{ summary.todo or 0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted small">완료</div>
        <div class="fs-3 fw-bold">{{ summary.done or 0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-lg-3">
    <div class="card shadow-sm border-danger">
      <div class="card-body">
        <div class="text-muted small">오버듀</div>
        <div class="fs-3 fw-bold text-danger">{{ summary.overdue or 0 }}</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Today -->
  <div class="col-12 col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0">오늘 마감</h6>
          <span class="badge text-bg-light">{{ due_today|length }}</span>
        </div>

        {% for t in due_today %}
          <div class="d-flex justify-content-between align-items-start border rounded p-2 mb-2">
            <div>
              <div class="fw-semibold {% if t.is_done %}text-decoration-line-through text-muted{% endif %}">
                {{ t.title }}
              </div>
              {% if t.memo %}<div class="small text-muted">{{ t.memo }}</div>{% endif %}
            </div>
            <div class="d-flex gap-2">
              <form method="post" action="{{ url_for('todo.toggle', todo_id=t.id) }}">
                <button class="btn btn-sm btn-outline-success">
                  {% if t.is_done %}취소{% else %}완료{% endif %}
                </button>
              </form>
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('todo.edit_page', todo_id=t.id) }}">수정</a>
            </div>
          </div>
        {% else %}
          <div class="text-muted small">오늘 마감 할 일이 없습니다.</div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Overdue -->
  <div class="col-12 col-lg-6">
    <div class="card shadow-sm border-danger">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0 text-danger">마감 지난 할 일</h6>
          <span class="badge text-bg-danger">{{ overdue|length }}</span>
        </div>

        {% for t in overdue %}
          <div class="d-flex justify-content-between align-items-start border border-danger-subtle rounded p-2 mb-2">
            <div>
              <div class="fw-semibold">{{ t.title }}</div>
              <div class="small text-danger">마감: {{ t.due_date }}</div>
              {% if t.memo %}<div class="small text-muted">{{ t.memo }}</div>{% endif %}
            </div>
            <div class="d-flex gap-2">
              <form method="post" action="{{ url_for('todo.toggle', todo_id=t.id) }}">
                <button class="btn btn-sm btn-outline-success">완료</button>
              </form>
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('todo.edit_page', todo_id=t.id) }}">수정</a>
            </div>
          </div>
        {% else %}
          <div class="text-muted small">오버듀 할 일이 없습니다.</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
